<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juego 4 - Laberinto</title>

<style>
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  background: #111;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  touch-action: none;
}

.game {
  width: 360px;
  height: 600px;
  overflow: hidden;
  border: 4px solid gold;
  background: url("https://i.imgur.com/9KQZ4JX.jpg") center/cover no-repeat;
  position: relative;
}

.maze {
  position: absolute;
  width: 360px;
  height: 1400px;
}

.wall {
  position: absolute;
  background: #2b2b2b;
  border-radius: 6px;
}

.player {
  position: absolute;
  width: 32px;
  height: 32px;
  background: url("https://cdna.artstation.com/p/assets/images/images/047/256/128/original/benjamin-parga-oso-3-4-45ms.gif?1647163873") center/contain no-repeat;
  left: 10px;
  top: 10px;
}

.goal {
  position: absolute;
  width: 40px;
  height: 40px;
  background: url("https://i.pinimg.com/originals/4e/c5/7f/4ec57f0a9c32b5cc3d539a7a20e29304.gif") center/contain no-repeat;
  bottom: 20px;
  left: 160px;
}
</style>
</head>

<body>

<div class="game">
  <div class="maze" id="maze">

    <div class="player" id="player"></div>
    <div class="goal" id="goal"></div>

    <!-- PAREDES -->
    <div class="wall" style="top:60px; left:0; width:300px; height:20px;"></div>
    <div class="wall" style="top:120px; left:60px; width:300px; height:20px;"></div>
    <div class="wall" style="top:180px; left:0; width:280px; height:20px;"></div>
    <div class="wall" style="top:240px; left:80px; width:280px; height:20px;"></div>
    <div class="wall" style="top:300px; left:0; width:300px; height:20px;"></div>

    <div class="wall" style="top:400px; left:60px; width:300px; height:20px;"></div>
    <div class="wall" style="top:460px; left:0; width:280px; height:20px;"></div>
    <div class="wall" style="top:520px; left:80px; width:280px; height:20px;"></div>
    <div class="wall" style="top:580px; left:0; width:300px; height:20px;"></div>

    <div class="wall" style="top:700px; left:60px; width:300px; height:20px;"></div>
    <div class="wall" style="top:760px; left:0; width:280px; height:20px;"></div>
    <div class="wall" style="top:820px; left:80px; width:280px; height:20px;"></div>
    <div class="wall" style="top:880px; left:0; width:300px; height:20px;"></div>

    <div class="wall" style="top:1000px; left:60px; width:300px; height:20px;"></div>
    <div class="wall" style="top:1060px; left:0; width:280px; height:20px;"></div>
    <div class="wall" style="top:1120px; left:80px; width:280px; height:20px;"></div>
    <div class="wall" style="top:1180px; left:0; width:300px; height:20px;"></div>

  </div>
</div>

<script>
const player = document.getElementById("player");
const maze = document.getElementById("maze");
const goal = document.getElementById("goal");
const walls = document.querySelectorAll(".wall");

let x = 10;
let y = 10;
let speed = 4;
let dx = 0;
let dy = 0;

/* TECLADO */
document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp") dy = -1;
  if (e.key === "ArrowDown") dy = 1;
  if (e.key === "ArrowLeft") dx = -1;
  if (e.key === "ArrowRight") dx = 1;
});

document.addEventListener("keyup", () => {
  dx = 0;
  dy = 0;
});

/* TOUCH JOYSTICK */
document.addEventListener("touchmove", e => {
  const t = e.touches[0];
  dx = (t.clientX - window.innerWidth / 2) / 100;
  dy = (t.clientY - window.innerHeight / 2) / 100;
});

/* LOOP */
function update() {
  x += dx * speed;
  y += dy * speed;

  x = Math.max(0, Math.min(328, x));
  y = Math.max(0, Math.min(1360, y));

  player.style.left = x + "px";
  player.style.top = y + "px";

  maze.style.top = Math.min(0, 250 - y) + "px";

  checkCollisions();
  requestAnimationFrame(update);
}

function checkCollisions() {
  const p = player.getBoundingClientRect();

  for (let wall of walls) {
    const w = wall.getBoundingClientRect();
    if (p.left < w.right && p.right > w.left && p.top < w.bottom && p.bottom > w.top) {
      alert("üí• Tocaste una pared");
      location.reload();
    }
  }

  const g = goal.getBoundingClientRect();
  if (p.left < g.right && p.right > g.left && p.top < g.bottom && p.bottom > g.top) {
    localStorage.setItem("juego5", "desbloqueado");
    alert("üèÜ ¬°Laberinto completado!");
    location.href = "mapa.html";
  }
}

update();
</script>

</body>
</html>
