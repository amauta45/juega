<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juego 3 - Atrapa los Corazones</title>

<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  overflow: hidden;
}

/* ESCENARIO */
.game {
  position: relative;
  width: 100vw;
  height: 100vh;
  background: url("https://i.pinimg.com/736x/70/6c/b0/706cb09844b2feef811a9fc584bf3719.jpg")
              center/cover no-repeat;
}

/* PERSONAJE (M√ÅS ARRIBA) */
.player {
  position: absolute;
  bottom: 35%; /* ‚Üê AQU√ç SE SUBE EL PERSONAJE */
  left: 70%;
  width: 90px;
  height: 50px;
  transform: translateX(-50%);
  background: url("https://i.gifer.com/origin/d6/d66ffd1987d422d9b3db13cebcb87947_w200.gif")
              center/contain no-repeat;
}

/* CORAZONES */
.heart {
  position: absolute;
  width: 45px;
  height: 45px;
  background: url("https://cdn-icons-png.flaticon.com/512/833/833472.png")
              center/contain no-repeat;
}

/* PIEDRAS */
.rock {
  position: absolute;
  width: 50px;
  height: 50px;
  background: url("https://png.pngtree.com/png-clipart/20210108/ourmid/pngtree-monochrome-rock-clip-art-png-image_2689540.jpg")
              center/contain no-repeat;
}

/* BARRA DE PROGRESO */
.bar {
  position: absolute;
  top: 12px;
  left: 50%;
  transform: translateX(-50%);
  width: 85%;
  max-width: 350px;
  height: 26px;
  border: 3px solid white;
  border-radius: 15px;
  background: rgba(0,0,0,0.4);
}

.fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(to right, pink, hotpink);
  border-radius: 15px;
  transition: width 0.2s;
}

/* AJUSTES PARA CELULAR */
@media (max-width: 600px) {
  .player {
    width: 90px;
    height: 90px;
  }

  .heart, .rock {
    width: 42px;
    height: 42px;
  }
}
</style>
</head>

<body>

<div class="game" id="game">
  <div class="bar"><div class="fill" id="fill"></div></div>
  <div class="player" id="player"></div>
</div>

<script>
const game = document.getElementById("game");
const player = document.getElementById("player");
const fill = document.getElementById("fill");

let playerX = window.innerWidth / 2;
let progress = 0;
let speed = 4;
let gameOver = false;

/* MOVIMIENTO PC */
document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft") playerX -= 35;
  if (e.key === "ArrowRight") playerX += 35;
  movePlayer();
});

/* MOVIMIENTO CELULAR */
game.addEventListener("touchmove", e => {
  e.preventDefault();
  playerX = e.touches[0].clientX - player.offsetWidth / 2;
  movePlayer();
}, { passive: false });

function movePlayer() {
  const maxX = window.innerWidth - player.offsetWidth;
  playerX = Math.max(0, Math.min(maxX, playerX));
  player.style.left = playerX + "px";
}

/* CREAR OBJETOS */
function spawn(type) {
  const el = document.createElement("div");
  el.className = type;
  el.style.left = Math.random() * (window.innerWidth - 60) + "px";
  el.style.top = "-60px";
  game.appendChild(el);

  const fall = setInterval(() => {
    if (gameOver) {
      clearInterval(fall);
      el.remove();
      return;
    }

    el.style.top = el.offsetTop + speed + "px";

    const p = player.getBoundingClientRect();
    const o = el.getBoundingClientRect();

    if (
      p.left < o.right &&
      p.right > o.left &&
      p.top < o.bottom &&
      p.bottom > o.top
    ) {
      if (type === "heart") {
        progress += 5;
        fill.style.width = progress + "%";
        el.remove();
        clearInterval(fall);

        if (progress >= 100) win();
      } else {
        lose();
      }
    }

    if (el.offsetTop > window.innerHeight) {
      el.remove();
      clearInterval(fall);
    }
  }, 20);
}

/* GENERADORES */
setInterval(() => spawn("heart"), 900);
setInterval(() => spawn("rock"), 700);

/* PERDER */
function lose() {
  gameOver = true;
  alert("üíî Tocaste una piedra. Int√©ntalo otra vez");
  location.reload();
}

/* GANAR */
function win() {
  gameOver = true;
  localStorage.setItem("juego4", "desbloqueado");
  alert("‚ù§Ô∏è ¬°Nivel completado! Juego 4 desbloqueado");
  location.href = "mapa.html";
}
</script>

</body>
</html>



