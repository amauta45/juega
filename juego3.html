<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juego 3 - Atrapa los Corazones</title>

<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  overflow: hidden;
}

/* CONTENEDOR */
.game {
  position: relative;
  width: 100vw;
  height: 100vh;
  background: url("https://i.pinimg.com/736x/70/6c/b0/706cb09844b2feef811a9fc584bf3719.jpg") center/cover no-repeat;
}

/* JUGADOR */
.player {
  position: absolute;
  bottom: 5vh;
  width: 12vw;
  max-width: 60px;
  min-width: 40px;
  aspect-ratio: 1;
  background: url("https://i.gifer.com/origin/d6/d66ffd1987d422d9b3db13cebcb87947_w200.gif") center/contain no-repeat;
}

/* OBJETOS */
.heart, .rock {
  position: absolute;
  width: 8vw;
  max-width: 45px;
  min-width: 30px;
  aspect-ratio: 1;
}

.heart {
  background: url("https://cdn-icons-png.flaticon.com/512/833/833472.png") center/contain no-repeat;
}

.rock {
  background: url("https://png.pngtree.com/png-clipart/20210108/ourmid/pngtree-monochrome-rock-clip-art-png-image_2689540.jpg") center/contain no-repeat;
}

/* BARRA */
.bar {
  position: absolute;
  top: 2vh;
  left: 50%;
  transform: translateX(-50%);
  width: 80vw;
  max-width: 320px;
  height: 26px;
  border: 3px solid white;
  border-radius: 15px;
  background: rgba(0,0,0,0.4);
}

.fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(to right, pink, hotpink);
  border-radius: 15px;
  transition: width 0.2s;
}
</style>
</head>

<body>

<div class="game" id="game">
  <div class="bar"><div class="fill" id="fill"></div></div>
  <div class="player" id="player"></div>
</div>

<script>
const game = document.getElementById("game");
const player = document.getElementById("player");
const fill = document.getElementById("fill");

let progress = 0;
let speed = 4;
let gameOver = false;

/* POSICI√ìN INICIAL */
function centerPlayer() {
  player.style.left = (game.clientWidth / 2 - player.offsetWidth / 2) + "px";
}
centerPlayer();
window.addEventListener("resize", centerPlayer);

/* MOVER JUGADOR */
function movePlayer(x) {
  const maxX = game.clientWidth - player.offsetWidth;
  x = Math.max(0, Math.min(maxX, x));
  player.style.left = x + "px";
}

/* PC */
document.addEventListener("keydown", e => {
  let x = player.offsetLeft;
  if (e.key === "ArrowLeft") movePlayer(x - 30);
  if (e.key === "ArrowRight") movePlayer(x + 30);
});

/* CELULAR */
game.addEventListener("touchmove", e => {
  movePlayer(e.touches[0].clientX - player.offsetWidth / 2);
});

/* CREAR OBJETOS */
function spawn(type) {
  const el = document.createElement("div");
  el.className = type;

  const size = Math.random() * 10 + 30;
  el.style.width = size + "px";
  el.style.height = size + "px";

  el.style.left = Math.random() * (game.clientWidth - size) + "px";
  el.style.top = "-50px";
  game.appendChild(el);

  let fall = setInterval(() => {
    if (gameOver) {
      el.remove();
      clearInterval(fall);
      return;
    }

    el.style.top = el.offsetTop + speed + "px";

    const p = player.getBoundingClientRect();
    const o = el.getBoundingClientRect();

    if (
      p.left < o.right &&
      p.right > o.left &&
      p.top < o.bottom &&
      p.bottom > o.top
    ) {
      if (type === "heart") {
        progress += 5;
        fill.style.width = progress + "%";
        el.remove();
        clearInterval(fall);
        if (progress >= 100) win();
      } else {
        lose();
      }
    }

    if (el.offsetTop > game.clientHeight) {
      el.remove();
      clearInterval(fall);
    }
  }, 20);
}

/* GENERADORES */
setInterval(() => spawn("heart"), 900);
setInterval(() => spawn("rock"), 700);

/* PERDER */
function lose() {
  gameOver = true;
  alert("üíî Tocaste una piedra");
  location.reload();
}

/* GANAR */
function win() {
  gameOver = true;
  localStorage.setItem("juego4", "desbloqueado");
  alert("‚ù§Ô∏è Nivel completado");
  location.href = "mapa.html";
}
</script>

</body>
</html>
